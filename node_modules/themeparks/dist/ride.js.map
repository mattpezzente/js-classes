{"version":3,"sources":["../lib/ride.js"],"names":["Schedule","require","Moment","s_rideID","Symbol","s_rideName","s_currentWaitTime","s_fastPassAvailable","s_fastPassReturnTimeAvailable","s_fastPassReturnTimeStart","s_fastPassReturnTimeEnd","s_lastTimeUpdate","s_lastTimeFastPassUpdate","s_scheduleData","Ride","options","ride_id","ride_name","Error","openingHours","GetDate","date","jsonData","id","name","Name","active","Active","waitTime","WaitTime","fastPass","FastPass","lastUpdate","LastUpdate","status","Status","fastPassReturnTime","startTime","FastPassReturnTimeStart","endTime","FastPassReturnTimeEnd","schedule","rideData","SetDate","special","length","i","specialSchedule","openingTime","closingTime","type","specialHours","value","undefined","Date","now","isSame","format","todaysSchedule","module","exports"],"mappings":";;;;;;AAAA;AACA,IAAIA,WAAWC,QAAQ,YAAR,CAAf;AACA,IAAIC,SAASD,QAAQ,iBAAR,CAAb;;AAEA;AACA,IAAIE,WAAWC,QAAf;AACA,IAAIC,aAAaD,QAAjB;AACA,IAAIE,oBAAoBF,QAAxB;AACA,IAAIG,sBAAsBH,QAA1B;AACA,IAAII,gCAAgCJ,QAApC;AACA,IAAIK,4BAA4BL,QAAhC;AACA,IAAIM,0BAA0BN,QAA9B;AACA,IAAIO,mBAAmBP,QAAvB;AACA,IAAIQ,2BAA2BR,QAA/B;AACA,IAAIS,iBAAiBT,QAArB;;AAEA;;;;;;;;;;AAUA;;;;;;;IAMMU,I;AACF;;;;;;AAMA,oBAGG;AAAA,YAHSC,OAGT,uEAHmB;AAClBC,qBAAS,IADS;AAElBC,uBAAW;AAFO,SAGnB;;AAAA;;AACC,YAAI,CAACF,QAAQC,OAAb,EAAsB,MAAM,IAAIE,KAAJ,CAAU,wCAAV,CAAN;AACtB,YAAI,CAACH,QAAQE,SAAT,IAAsBF,QAAQE,SAAR,IAAqB,EAA/C,EAAmD,MAAM,IAAIC,KAAJ,CAAU,0CAAV,CAAN;;AAEnD,aAAKf,QAAL,IAAiBY,QAAQC,OAAzB;AACA,aAAKX,UAAL,IAAmBU,QAAQE,SAA3B;;AAEA;AACA,aAAKV,mBAAL,IAA4B,KAA5B;;AAEA;AACA,aAAKM,cAAL,IAAuB,IAAIb,QAAJ,EAAvB;AACH;;AAED;;;;;;;;iCAIS;AACL;AACA,gBAAImB,eAAe,KAAKN,cAAL,EAAqBO,OAArB,CAA6B;AAC5CC,sBAAMnB;AADsC,aAA7B,CAAnB;AAGA,gBAAIoB,WAAW;AACXC,oBAAI,KAAKpB,QAAL,CADO;AAEXqB,sBAAM,KAAKC,IAFA;AAGXC,wBAAQ,KAAKC,MAHF;AAIXC,0BAAU,KAAKC,QAJJ;AAKXC,0BAAU,KAAKC,QALJ;AAMXC,4BAAY,KAAKC,UANN;AAOXC,wBAAQ,KAAKC;AAPF,aAAf;;AAUA;AACA,gBAAI,KAAK3B,6BAAL,CAAJ,EAAyC;AACrCc,yBAASc,kBAAT,GAA8B;AAC1BC,+BAAW,KAAKC,uBADU;AAE1BC,6BAAS,KAAKC,qBAFY;AAG1BR,gCAAY,KAAKpB,wBAAL;AAHc,iBAA9B;AAKH;;AAED;AACA,gBAAIO,YAAJ,EAAkB;AACdG,yBAASmB,QAAT,GAAoBtB,YAApB;AACH;;AAED,mBAAOG,QAAP;AACH;;AAED;;;;;;;;iCAKSoB,Q,EAAU;AACf;AACA,iBAAKvC,QAAL,IAAiBuC,SAASnB,EAA1B;AACA,iBAAKlB,UAAL,IAAmBqC,SAASlB,IAA5B;AACA,iBAAKb,gBAAL,IAAyB+B,SAASV,UAAlC;AACA,iBAAKzB,mBAAL,IAA4BmC,SAASZ,QAArC;;AAEA;AACA,gBAAI,CAACY,SAAShB,MAAd,EAAsB;AAClB;AACA,qBAAKpB,iBAAL,IAA0B,CAAC,CAA3B;AACH,aAHD,MAGO;AACH,qBAAKA,iBAAL,IAA0BoC,SAASd,QAAnC;AACH;;AAED;AACA,gBAAIc,SAASD,QAAb,EAAuB;AACnB,qBAAK5B,cAAL,EAAqB8B,OAArB,CAA6BD,SAASD,QAAtC;;AAEA;AACA,oBAAIC,SAASD,QAAT,CAAkBG,OAAlB,IAA6BF,SAASD,QAAT,CAAkBG,OAAlB,CAA0BC,MAA1B,GAAmC,CAApE,EAAuE;AACnE,yBAAK,IAAIC,CAAJ,EAAOC,eAAZ,EAA6BA,kBAAkBL,SAASD,QAAT,CAAkBG,OAAlB,CAA0BE,GAA1B,CAA/C,GAAgF;AAC5E,6BAAKjC,cAAL,EAAqB8B,OAArB,CAA6B;AACzBtB,kCAAM0B,gBAAgB1B,IADG;AAEzB2B,yCAAaD,gBAAgBC,WAFJ;AAGzBC,yCAAaF,gBAAgBE,WAHJ;AAIzBC,kCAAMH,gBAAgBG,IAJG;AAKzBC,0CAAc;AALW,yBAA7B;AAOH;AACJ;AACJ;AACJ;;AAED;;;;;;;;4BAKW;AACP,mBAAO,KAAK9C,UAAL,CAAP;AACH;;AAED;;;;;;;;;0BAMa+C,K,EAAO;AAChB;AACA,gBAAI,KAAK9C,iBAAL,MAA4B+C,SAA5B,IAAyC,KAAK/C,iBAAL,KAA2B8C,KAAxE,EAA+E;AAC3E;AACA,qBAAKzC,gBAAL,IAAyB2C,KAAKC,GAAL,EAAzB;AACA;AACA,qBAAKjD,iBAAL,IAA0B8C,KAA1B;AACH;;AAED;AACH;;AAED;;;;;;4BAKe;AACX;AACA,gBAAI,KAAK9C,iBAAL,MAA4B+C,SAA5B,IAAyC,KAAK/C,iBAAL,IAA0B,CAAvE,EAA0E,OAAO,CAAP;;AAE1E,mBAAO,KAAKA,iBAAL,CAAP;AACH;;AAED;;;;;;;0BAIa8C,K,EAAO;AAChB,gBAAI,KAAK7C,mBAAL,KAA6B6C,KAAjC,EAAwC;AACpC;AACA,qBAAKzC,gBAAL,IAAyB2C,KAAKC,GAAL,EAAzB;AACA;AACA,qBAAKhD,mBAAL,IAA4B6C,KAA5B;AACH;AACJ;;AAED;;;;;4BAIe;AACX,mBAAO,KAAK7C,mBAAL,CAAP;AACH;;AAED;;;;;;;;0BAKgC6C,K,EAAO;AACnC,gBAAIA,SAAS,KAAK5C,6BAAL,CAAb,EAAkD;AAC9C;AACA,qBAAKA,6BAAL,IAAsC4C,KAAtC;AACA;AACA,qBAAKxC,wBAAL,IAAiC0C,KAAKC,GAAL,EAAjC;AACH;AACJ;;AAED;;;;4BAGkC;AAC9B,mBAAO,KAAK/C,6BAAL,CAAP;AACH;;AAED;;;;;;;0BAI4B4C,K,EAAO;AAC/B;AACA,gBAAI,CAACA,MAAMI,MAAN,CAAa,KAAK/C,yBAAL,CAAb,CAAL,EAAoD;AAChD;AACA,qBAAKD,6BAAL,IAAsC,IAAtC;AACA;AACA,qBAAKI,wBAAL,IAAiC0C,KAAKC,GAAL,EAAjC;AACA;AACA,qBAAK9C,yBAAL,IAAkC2C,KAAlC;AACH;AACJ;;AAED;;;;;4BAI8B;AAC1B,mBAAO,KAAK3C,yBAAL,EAAgCgD,MAAhC,CAAuC,OAAvC,CAAP;AACH;;AAED;;;;;;;0BAI0BL,K,EAAO;AAC7B;AACA,gBAAI,CAACA,MAAMI,MAAN,CAAa,KAAK9C,uBAAL,CAAb,CAAL,EAAkD;AAC9C;AACA,qBAAKF,6BAAL,IAAsC,IAAtC;AACA;AACA,qBAAKI,wBAAL,IAAiC0C,KAAKC,GAAL,EAAjC;AACA;AACA,qBAAK7C,uBAAL,IAAgC0C,KAAhC;AACH;AACJ;;AAED;;;;;4BAI4B;AACxB,mBAAO,KAAK1C,uBAAL,EAA8B+C,MAA9B,CAAqC,OAArC,CAAP;AACH;;AAED;;;;;;;4BAIa;AACT;AACA,gBAAI,KAAKnD,iBAAL,MAA4B+C,SAAhC,EAA2C,OAAO,KAAP;;AAE3C,mBAAO,KAAK/C,iBAAL,KAA2B,CAAlC;AACH;;AAED;;;;;;;;4BAKa;AACT;AACA;AACA;AACA,gBAAIoD,iBAAiB,KAAK1D,QAAL,CAAcoB,OAAd,CAAsB;AACvCC,sBAAMnB;AADiC,aAAtB,CAArB;AAGA,gBAAIwD,kBAAkBA,eAAeR,IAAf,IAAuB,WAA7C,EAA0D;AACtD,uBAAOQ,eAAeR,IAAtB;AACH;;AAED;AACA,gBAAI,KAAK5C,iBAAL,KAA2B,CAAC,CAAhC,EAAmC,OAAO,MAAP;;AAEnC;AACA,mBAAQ,KAAKqB,MAAL,GAAc,WAAd,GAA4B,QAApC;AACH;;AAED;;;;;;;;4BAKiB;AACb,mBAAO,KAAKhB,gBAAL,CAAP;AACH;;AAED;;;;;;;4BAIe;AACX,mBAAO,KAAKE,cAAL,CAAP;AACH;;;;;;AAGL;;;AACA8C,OAAOC,OAAP,GAAiB9C,IAAjB","file":"ride.js","sourcesContent":["// our schedule library\nvar Schedule = require(\"./schedule\");\nvar Moment = require(\"moment-timezone\");\n\n// symbols\nvar s_rideID = Symbol();\nvar s_rideName = Symbol();\nvar s_currentWaitTime = Symbol();\nvar s_fastPassAvailable = Symbol();\nvar s_fastPassReturnTimeAvailable = Symbol();\nvar s_fastPassReturnTimeStart = Symbol();\nvar s_fastPassReturnTimeEnd = Symbol();\nvar s_lastTimeUpdate = Symbol();\nvar s_lastTimeFastPassUpdate = Symbol();\nvar s_scheduleData = Symbol();\n\n/**\n * @typedef RideData\n * @type Object\n * @property {String} id Unique Ride ID\n * @property {String} name The ride's name\n * @property {Bool} active Is this ride currently operating?\n * @property {Number} wait_time Ride's current queue time\n * @property {Number} last_update Last time this Ride has a wait time change (in milliseconds)\n */\n\n/**\n * Ride Class\n * Each ride object represents one ride at a theme park.\n * This object will hold the ride's current state.\n * @class\n */\nclass Ride {\n    /**\n     * Create a new Ride object\n     * @param {Object} options New ride data\n     * @param {String} options.ride_id Ride's Unique ID\n     * @param {String} options.ride_name Ride name\n     */\n    constructor(options = {\n        ride_id: null,\n        ride_name: null\n    }) {\n        if (!options.ride_id) throw new Error(\"No ride ID supplied to new ride object\");\n        if (!options.ride_name || options.ride_name == \"\") throw new Error(\"No ride name supplied to new ride object\");\n\n        this[s_rideID] = options.ride_id;\n        this[s_rideName] = options.ride_name;\n\n        // by default, rides don't support fastpass\n        this[s_fastPassAvailable] = false;\n\n        // make our own schedule data object!\n        this[s_scheduleData] = new Schedule();\n    }\n\n    /**\n     * Serialize this object (automatically called by JSON.stringify etc.)\n     * @returns {RideData} Current ride state\n     */\n    toJSON() {\n        // try to extract schedule data for this ride\n        var openingHours = this[s_scheduleData].GetDate({\n            date: Moment(),\n        });\n        var jsonData = {\n            id: this[s_rideID],\n            name: this.Name,\n            active: this.Active,\n            waitTime: this.WaitTime,\n            fastPass: this.FastPass,\n            lastUpdate: this.LastUpdate,\n            status: this.Status\n        };\n\n        // add fastPass return times (if available)\n        if (this[s_fastPassReturnTimeAvailable]) {\n            jsonData.fastPassReturnTime = {\n                startTime: this.FastPassReturnTimeStart,\n                endTime: this.FastPassReturnTimeEnd,\n                lastUpdate: this[s_lastTimeFastPassUpdate]\n            };\n        }\n\n        // add opening hours to ride data if we actually have any!\n        if (openingHours) {\n            jsonData.schedule = openingHours;\n        }\n\n        return jsonData;\n    }\n\n    /** \n     * Restore a state from a JSON object\n     * Mainly used to restore ride data from cached data\n     * @param {RideData} rideData Ride data to restore (ideally created using toJSON)\n     */\n    fromJSON(rideData) {\n        // restore base ride data\n        this[s_rideID] = rideData.id;\n        this[s_rideName] = rideData.name;\n        this[s_lastTimeUpdate] = rideData.lastUpdate;\n        this[s_fastPassAvailable] = rideData.fastPass;\n\n        // .Active is inferred by WaitTime\n        if (!rideData.active) {\n            // set WaitTime to -1 if the ride isn't active\n            this[s_currentWaitTime] = -1;\n        } else {\n            this[s_currentWaitTime] = rideData.waitTime;\n        }\n\n        // import any schedule data (if we have any)\n        if (rideData.schedule) {\n            this[s_scheduleData].SetDate(rideData.schedule);\n\n            // also re-import special schedule data (if we have any)\n            if (rideData.schedule.special && rideData.schedule.special.length > 0) {\n                for (var i, specialSchedule; specialSchedule = rideData.schedule.special[i++];) {\n                    this[s_scheduleData].SetDate({\n                        date: specialSchedule.date,\n                        openingTime: specialSchedule.openingTime,\n                        closingTime: specialSchedule.closingTime,\n                        type: specialSchedule.type,\n                        specialHours: true\n                    });\n                }\n            }\n        }\n    }\n\n    /**\n     * Get this ride's name\n     * Note: Will attempt to return in English, but will fallback to park's local locale if English isn't available\n     * @type {String}\n     */\n    get Name() {\n        return this[s_rideName];\n    }\n\n    /**\n     * Set this ride's wait time\n     * Set to -1 when ride is Closed\n     * Set to -2 when ride is Down\n     * @type {Number}\n     */\n    set WaitTime(value) {\n        // check for updated (or brand new) wait time for this ride\n        if (this[s_currentWaitTime] === undefined || this[s_currentWaitTime] != value) {\n            // update our last updated time to now\n            this[s_lastTimeUpdate] = Date.now();\n            // update our wait time for this ride\n            this[s_currentWaitTime] = value;\n        }\n\n        // value hasn't changed, don't do anything\n    }\n\n    /**\n     * Get this ride's current wait time. Will always be >= 0.\n     * Use .Active to determine ride's open status\n     * @type {Number}\n     */\n    get WaitTime() {\n        // always return positive ints for the wait time, even when inactive or not defined yet\n        if (this[s_currentWaitTime] === undefined || this[s_currentWaitTime] < 0) return 0;\n\n        return this[s_currentWaitTime];\n    }\n\n    /**\n     * Set this ride's fast pass availability\n     * @type {Boolean}\n     */\n    set FastPass(value) {\n        if (this[s_fastPassAvailable] != value) {\n            // update our last updated time to now\n            this[s_lastTimeUpdate] = Date.now();\n            // update fastpass status\n            this[s_fastPassAvailable] = value;\n        }\n    }\n\n    /**\n     * Get this ride's fast pass availability\n     * @type {Boolean}\n     */\n    get FastPass() {\n        return this[s_fastPassAvailable];\n    }\n\n    /**\n     * Set whether we have valid fast pass return times or not\n     * Setting start/end times automatically sets this to true, only need to call this if fastPass availability has ran out\n     * @type {Boolean}\n     */\n    set FastPassReturnTimeAvailable(value) {\n        if (value != this[s_fastPassReturnTimeAvailable]) {\n            // update availability\n            this[s_fastPassReturnTimeAvailable] = value;\n            // update our last fastPass updated time to now\n            this[s_lastTimeFastPassUpdate] = Date.now();\n        }\n    }\n\n    /**\n     * Does this ride have a fastPass return time available?\n     */\n    get FastPassReturnTimeAvailable() {\n        return this[s_fastPassReturnTimeAvailable];\n    }\n\n    /**\n     * Set this ride's fastPass return time window start\n     * @type {Moment} Time\n     */\n    set FastPassReturnTimeStart(value) {\n        // check if this fastPass is \n        if (!value.isSame(this[s_fastPassReturnTimeStart])) {\n            // mark this as true so we know to add this to our JSON object\n            this[s_fastPassReturnTimeAvailable] = true;\n            // update our last fastPass updated time to now\n            this[s_lastTimeFastPassUpdate] = Date.now();\n            // use new fastPass return start time\n            this[s_fastPassReturnTimeStart] = value;\n        }\n    }\n\n    /**\n     * Get this ride's fast pass return time start\n     * @type {String} Time in format of \"HH:mm\"\n     */\n    get FastPassReturnTimeStart() {\n        return this[s_fastPassReturnTimeStart].format(\"HH:mm\");\n    }\n\n    /**\n     * Set this ride's fastPass return time window end\n     * @type {Moment} Time\n     */\n    set FastPassReturnTimeEnd(value) {\n        // check if this fastPass is \n        if (!value.isSame(this[s_fastPassReturnTimeEnd])) {\n            // mark this as true so we know to add this to our JSON object\n            this[s_fastPassReturnTimeAvailable] = true;\n            // update our last fastPass updated time to now\n            this[s_lastTimeFastPassUpdate] = Date.now();\n            // use new fastPass return end time\n            this[s_fastPassReturnTimeEnd] = value;\n        }\n    }\n\n    /**\n     * Get this ride's fast pass return time emd\n     * @type {String} Time in format of \"HH:mm\"\n     */\n    get FastPassReturnTimeEnd() {\n        return this[s_fastPassReturnTimeEnd].format(\"HH:mm\");\n    }\n\n    /**\n     * Is this ride currently running?\n     * @type {Boolean}\n     */\n    get Active() {\n        // if we have no data yet, assume ride is inactive\n        if (this[s_currentWaitTime] === undefined) return false;\n\n        return this[s_currentWaitTime] >= 0;\n    }\n\n    /**\n     * String status for this ride\n     * Can only ever be either \"Operating\", \"Down\", \"Closed\", or \"Refurbishment\"\n     * @type {String}\n     */\n    get Status() {\n        // first, check the schedule for non-operating types\n        //  refurbishment/closed schedule overrules all other statuses, as this is planned maintenance\n        //  i.e, rides don't usually schedule maintenance and then randomly open mid-day \n        var todaysSchedule = this.Schedule.GetDate({\n            date: Moment()\n        });\n        if (todaysSchedule && todaysSchedule.type != \"Operating\") {\n            return todaysSchedule.type;\n        }\n\n        // wait time set to -2 when ride is Down\n        if (this[s_currentWaitTime] == -2) return \"Down\";\n\n        // otherwise, return a string matching current Active status\n        return (this.Active ? \"Operating\" : \"Closed\");\n    }\n\n    /**\n     * Get this ride's last wait time update time.\n     * Note: Can be undefined\n     * @type {Number}\n     */\n    get LastUpdate() {\n        return this[s_lastTimeUpdate];\n    }\n\n    /**\n     * Get this ride's schedule object\n     * @type {Schedule}\n     */\n    get Schedule() {\n        return this[s_scheduleData];\n    }\n}\n\n// export the Ride class\nmodule.exports = Ride;"]}